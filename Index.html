<!DOCTYPE html>
<html>
<head>
    <title>DreadHead App</title>
    <meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Dread-ur-head app shows you how it would look like, if you would have dreads.">	
	<meta name="developper" content="Mike Barmettler">

	<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /> 

	<!-- bootstrap, jquery, jquery ui -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>	
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

	<!-- jquery ui touch punch -->
	<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>

	<!-- rotation resources -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/godswearhats/jquery-ui-rotatable@1.1/jquery.ui.rotatable.css">
	<script src="https://cdn.jsdelivr.net/gh/godswearhats/jquery-ui-rotatable@1.1/jquery.ui.rotatable.min.js"></script>
		
	<!--jwatermark-->
	<!-- <script src="libs/baivong-watermark-2dd6d88/dist/jquery.watermark.min.js"></script> -->
	
	<!-- jcanvas -->
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jcanvas/20.1.4/min/jcanvas.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jcanvas/20.1.4/min/jcanvas-crescents.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jcanvas/20.1.4/min/jcanvas-donuts.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jcanvas/20.1.4/min/jcanvas-handles.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jcanvas/20.1.4/min/jcanvas-hearts.min.js"></script>


	<!--bs slider-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.0.0/bootstrap-slider.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.0.0/css/bootstrap-slider.min.css"  type="text/css">
	
	<!--app style-->
	<link rel="stylesheet" href="Assets/css/site.css" type="text/css">	

	<!-- site scripts -->
	<script src="Assets/js/site.js"></script>
	

	<style>
		.special-header {
			margin-top: -42px;;
		}
	</style>

<script>
$(function () {			
		
		//init DreadSelectionList
		initializeDreadSelectionList(dreadSelectionArray);		
	
		// Instantiate a slider
		$("#imgZoomslider").bootstrapSlider();			
									
		//selecting dreads and add to cropping area
		$(".thumbnail").on("click", function(){	
			if(!$(this).hasClass('active'))
			{ 		
				$(".thumbnail").removeClass("active");
				$(this).addClass("active");
			}									
			
		 	$(".ui-wrapper img").remove();
					
			//prepare dread img from selectionlist
			var dreadImgsrc = $(this).find('img').clone();
			dreadImgsrc.removeClass();
			dreadImgsrc.prop("id", "userDreads");	

			//add new dread selection
			$("#croppingArea").append(dreadImgsrc);						
			
			var options = {
			  rotationCenterOffset: {
					top: 0,
					left: 0
				}
			};
						
			//adding img editing options				
			dreadImgsrc.resizable({ handles: "ne" });
//todo change resize image
					// handle: "ne"
					// handles: { 'e': '.ui-resizable-e', 's': '.ui-resizable-s', 'se': '.ui-resizable-se'}
					  		   
  			dreadImgsrc.parent().rotatable(options);
			dreadImgsrc.parent().css("z-index", 1);
			dreadImgsrc.parent().draggable({ appendTo: '#cropping-area', scroll:false});		

			//place rotatable icon on top left
			$(".ui-rotatable-handle").prependTo(".ui-wrapper");

			//enable functional buttons
			$('.btn').removeClass("disabled");		
		});					
		
		//render with watermark & download image locally
		$("#dwlBtn").on("click", function(e) {
			e.preventDefault();  //stop the browser from following
									
			var dread = $("#userDreads").attr("src");
			var portrait = $("#userPortrait").attr('src');
			
			var dreadwidth = $("#userDreads").width();
			var dreadHeight = $("#userDreads").height();

			var potraitWidth =  $("#userPortrait").width();
			var potraitHeight =  $("#userPortrait").height();

			var ratioDread = 0;
			var ratioPortrait = 0;
			if($("#userDreads").width() > $("#userDreads").height())
			{
				ratioDread =  $("#userDreads").width() / $("#userDreads").height();
			}
			if($("#userDreads").height() > $("#userDreads").width())
			{
				ratioDread = $("#userDreads").height() / $("#userDreads").width();
			}


			$("#canvas").drawImage({
				  source: "http://dreadlocks-artesanal.ch/dreadhead/Assets/img/corp/logo.png",
				  x: 50, y: 50,
				  width: "90",
				  height: "90"
				 })
				.drawText({
					font: '13pt sans-serif',
					fillStyle: '#333333',
					strokeStyle: '#75a62b',
					x: 100,	
					y: dreadHeight+150,
					align: 'left',
					strokeWidth: 1,
					text: "dreadlocks-artesenal.ch"
				})
				.drawImage({
					source: portrait,	
					x: potraitWidth,
					y: potraitHeight,
					width: potraitWidth,
					height: potraitHeight
				})
				.drawImage({
					source: dread,
					x: potraitWidth-10,
					y: potraitHeight,					
					width: dreadwidth,
					height: dreadHeight
				});   

			$('#canvas').getCanvasImage('png');
			$('#canvas').getCanvasImage('jpeg', 1);
			//top.location.href = $('#canvas').getCanvasImage('png');;
		});

		//share image
		$("#shareBtn").on("click", function (e) {
			e.preventDefault();  //stop the browser from following
			 
		});
		
		//update slider
		$("#imgZoomslider").on("slide", function(slideEvt) {
			//alert(slideEvt.value);	
			var userportrait =  $("#userPortrait");		
			var ratio = slideEvt.value;
			var oneProc = orginalPortraitWidth/100;
			var newWidth = oneProc*ratio;
			if(newWidth > 100)
			{
				userportrait.width(newWidth);				
			}
		});
	
	//end of doc ready
	});
</script>
</head>

<body>
    <div class="container-fluid">
		<div class="row">
			<div class="col-md-1">	
				<a href="http://dreadlocks-artesanal.ch/" target="_blank">
					<img src="Assets/img/corp/logo.png" width="150"/>
				</a>
			</div>
		</div>
		<div class="row">
            <div class="col-md-8">
                <div class="jumbotron">
					<div id="croppingArea" class="cropping-area"></div>
					<input type="text" id="imgZoomslider" data-slider-min="0" data-slider-max="100" data-slider-step="1" data-slider-value="10" />
					<br/><br/>
					<h3><span class="label label-outline-default">1</span> make your choice for your portrait</h3>
					<input type="file" class="inputfile" id="myPortraitSelector"/>
					<label for="myPortraitSelector" class="btn btn-danger"><i class="fa fa-upload" aria-hidden="true"></i>
						select</label>
					<br/><br/>

					<h3><span class="label label-outline-default">3</span> save or share with friends</h3>					
					<button class="btn btn-success disabled" id="dwlBtn"><i class="fa fa-arrow-circle-down" aria-hidden="true"></i>
						save
					</button>
					<a href="#shareModal" role="button" class="btn btn-primary disabled" data-toggle="modal" id="shareBtn"><i class="fa fa-share-alt" aria-hidden="true"></i>
						share
					</a>
				</div>
				
				<!--just for DEV testcases-->
				<canvas id="canvas" width="700px" height="900px" style="border:1px dotted red" />
			</div>
			<div class="col-md-2">
				<h3 class="special-header"><span class="label label-outline-default">2</span> choos your dreads</h3>										
				<div id="dreadSelectionList" class="row"/>
            </div>   			
		</div>
	</div>
  <!-- end of container -->

</body>
</html>
