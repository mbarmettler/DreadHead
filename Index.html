<!DOCTYPE html>
<html>
<head>
    <title>DreadHead App</title>
    <meta charset="utf-8" />
	 <meta name="viewport" content="width=device-width, initial-scale=1">
	
    <link rel="stylesheet" href="Assets/css/bootstrap.min.css">	
	
	<script src="https://code.jquery.com/jquery-1.11.2.js"></script>	
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	
	<!-- jquery touch punch (mobile)-->
	<script scrc="Assets/js/jquery.touchpunch.js"></script>

	<!-- rotation stuff -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/godswearhats/jquery-ui-rotatable@1.1/jquery.ui.rotatable.css">
	<script src="https://cdn.jsdelivr.net/gh/godswearhats/jquery-ui-rotatable@1.1/jquery.ui.rotatable.min.js"></script>
	
	<!-- <link rel="stylesheet" href="libs/jquery-free-transform-master/css/jquery.freetrans.css"> -->
	<!-- <script src="libs/jquery-free-transform-master/js/Matrix.js"></script> -->
	<!-- <script src="libs/jquery-free-transform-master/js/jquery.freetrans.js"></script> -->
	
	<!--jwatermark-->
	<script src="libs/baivong-watermark-2dd6d88/dist/jquery.watermark.min.js"></script>
	
	<!--bs slider-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.0.0/bootstrap-slider.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.0.0/css/bootstrap-slider.min.css"  type="text/css">
	
    <style>
        .html,body {
            height:600px;
        }
        .inputfile {
	        width: 0.1px;
	        height: 0.1px;
	        opacity: 0;
	        overflow: hidden;
	        position: absolute;
	        z-index: -1;
        }
		.slider-selection {
			background: lightblue;;
		}
		.dreadCanvasItem{
			float:left;
			width: 110px;
			margin-right: 10px;
		}
		 .cropping-area {
		    overflow:hidden;
			border-style: dashed;
			border-width:2px;
			max-height: 600px;
			min-height: 200px;
			align-items: center;  
		 }
		 .ui-resizable, .ui-draggable, .ui-draggable-handle {
			border: 1px dashed lightblue;
		 }
		 .ui-rotatable-handle {
			height: 16px;
			width: 16px;
			cursor: pointer;
			background-image: url(Assets/img/rotate.png);
			background-size: 100%;
			left: 2px;
			bottom: 2px;
		}
		.userDreads{
			cursor: move;
			padding:5px;
		}		
		.userPortrait{
			cursor: move;
			padding:5px;
		}
    </style>
<script>
	
var useBlob   = false && window.URL;
function readImage (file) {

	// Create a new FileReader instance
	// https://developer.mozilla.org/en/docs/Web/API/FileReader
	var reader = new FileReader();

	// Once a file is successfully readed:
	reader.addEventListener("load", function () {

		// At this point `reader.result` contains already the Base64 Data-URL
		// and we've could immediately show an image using
		// `elPreview.insertAdjacentHTML("beforeend", "<img src='"+ reader.result +"'>");`
		// But we want to get that image's width and height px values!
		// Since the File Object does not hold the size of an image
		// we need to create a new image and assign it's src, so when
		// the image is loaded we can calculate it's width and height:
		var image  = new Image();
		image.addEventListener("load", function () {
			  
			// Finally append our created image and the HTML info string to our `#preview` 
			$("#userPortrait").append( this );		
			
			 var options = {
			  rotationCenterOffset: {
					top: 0,
					left: 0
				}
			 };
								
			$("#userPortrait").resizable().rotatable(options);
										
			//adding resizing and dragging
			$("#userPortrait").draggable({
			appendTo:"#cropping-area", scroll: false })
										
			//enable functional buttons
			$('.btn').removeClass("disabled");							

			// If we set the variable `useBlob` to true:
			// (Data-URLs can end up being really large
			// `src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAA...........etc`
			// Blobs are usually faster and the image src will hold a shorter blob name
			// src="blob:http%3A//example.com/2a303acf-c34c-4d0a-85d4-2136eef7d723"
			if (useBlob) {
				// Free some memory for optimal performance
				window.URL.revokeObjectURL(image.src);
			}
		});
			
		image.src = useBlob ? window.URL.createObjectURL(file) : reader.result;
  });
  // https://developer.mozilla.org/en-US/docs/Web/API/FileReader/readAsDataURL
  reader.readAsDataURL(file);  
}

        $(function () {				
				// Instantiate a slider
				$("#imgZoomslider").bootstrapSlider();			
							  							  
				//Image uploaded event
				$("input:file").change(function () {
				
					 // Let's store the FileList Array into a variable:
					// https://developer.mozilla.org/en-US/docs/Web/API/FileList
					var files  = this.files;
					// Let's create an empty `errors` String to collect eventual errors into:
					var errors = "";

					if (!files) {
						errors += "File upload not supported by your browser.";
					}

					// Check for `files` (FileList) support and if contains at least one file:
					if (files && files[0]) {

						// Iterate over every File object in the FileList array
						for(var i=0; i<files.length; i++) {

							// Let's refer to the current File as a `file` variable
							// https://developer.mozilla.org/en-US/docs/Web/API/File
							var file = files[i];

							// Test the `file.name` for a valid image extension:
							// (pipe `|` delimit more image extensions)
							// The regex can also be expressed like: /\.(png|jpe?g|gif)$/i
							if ( (/\.(png|jpeg|jpg|gif)$/i).test(file.name) ) {
								// SUCCESS! It's an image!
								// Send our image `file` to our `readImage` function!
								readImage( file ); 
							}
							else {
							errors += file.name +" Unsupported Image extension\n";  
							}
						}
					}

					// Notify the user for any errors (i.e: try uploading a .txt file)
					if (errors) {
						alert(errors); 
					}
				});
				
				
				//selecting dreads and add to cropping area
				$(".list-group-item-action").on("click", function(){	
					if(!$(this).hasClass('active'))
					{ 		
						$(".list-group-item-action.active").removeClass("active");
						$(this).addClass("active");
					}				
					
					var dreadImgsrc = $(this).find('img');
					dreadImgsrc.removeClass();
					
					$("#userDreads").append(dreadImgsrc);
								
								 var options = {
								  rotationCenterOffset: {
										top: 0,
										left: 0
									}
								 };
								
					//adding resizing								
					$("#userDreads").resizable().rotatable(options);	
					            
					//adding dragging
					$("#userDreads").draggable({
					appendTo: '#cropping-area', scroll:false})//.find("img").resizable();		
				
				});					
				
				//render with watermark & download image locally
				$("#dwlBtn").on("click", function(e) {
					e.preventDefault();  //stop the browser from following
					
//todo generate from DIV
					//iniialize / adding watermark
					$('#userPortrait').watermark({
						path: 'http://i.imgur.com/LcpZHu5.png', 
						gravity: 'nw',
						opacity: 1,
						margin: 12,
						outputType: 'png',
						  done: function (imgURL) {						
								$('#outputimage').attr('src', imgURL);							
							}
					});
				});

				//share image
				$("#shareBtn").on("click", function (e) {
					e.preventDefault();  //stop the browser from following
				});
				
				//userportrait slider
				$("#imgZoomslider").on("slide", function(slideEvt) {
					//alert(slideEvt.value);					
				});

			//end of doc ready
			});
    </script>
</head>

<body>
    <div class="container-fluid">
        <div class="col-md">
            <h3>Dread-Ur-Head</h3>
        </div>

        <div class="row">
            <div class="col-md-7">
                <div class="jumbotron">
                    <form id="dreadHeadPortraitForm" action="" onsubmit="return false;">
                        <div id="croppingArea" class="cropping-area ui-widget-content" orientation="horizontal">
							<div id="userPortrait" class="userPortrait"></div>
							<div id="userDreads" class="userDreads"></div>
                        </div>
						<input type="text" id="imgZoomslider" data-slider-min="0" data-slider-max="20" data-slider-step="1" data-slider-value="10" />
                        <br/><br/>
                        <input type="file" class="inputfile" id="myPortraitSelector">
                        <label for="myPortraitSelector" class="btn btn-danger">Choose a file</label>
                    </form>
					<br/><br/>
					<button class="btn btn-success disabled" id="dwlBtn">save</button>
					<button class="btn btn-primary disabled" id="shareBtn">share</button>
				</div>
			<!--just for DEV testcases-->
			<div> 
				<img id="outputimage"/>
			</div>
			<!---->
			</div>
            <div class="col-md-3">
                <form method="post">
                    <div class="list-group">
                        <a href="#" class="list-group-item list-group-item-action">
                            <p> 
								<img class="dreadCanvasItem" src="Assets/img/dread1.png" /> 
								Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et
							</p>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action">
							<p> 
								<img class="dreadCanvasItem" src="Assets/img/hair2.png" /> 
								Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et
							</p>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action">
							<p> 
								<img class="dreadCanvasItem" src="Assets/img/noimg.jpg" /> 
								Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et
							</p>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action">
							<p> 
								<img class="dreadCanvasItem" src="Assets/img/noimg.jpg" /> 
								Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et
							</p>
                        </a>
                    </div>
                </form>
            </div>
        </div>

    </div>
</body>
</html>
